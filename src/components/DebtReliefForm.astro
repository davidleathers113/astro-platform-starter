---
import LockIcon from './icons/LockIcon.astro';
import PhoneIcon from './icons/PhoneIcon.astro';
import ShieldIcon from './icons/ShieldIcon.astro';
import CheckIcon from './icons/CheckIcon.astro';
import CreditCardAltIcon from './icons/CreditCardAltIcon.astro';
import CheckCircleIcon from './icons/CheckCircleIcon.astro';
---

<div id="consultation" class="consultation-section py-16 md:py-20 relative">
    <!-- Decorative background elements -->
    <div class="absolute top-0 left-0 right-0 h-1/2 bg-gradient-to-b from-primary/5 to-transparent -z-10"></div>
    <div class="absolute bottom-0 left-0 right-0 h-1/2 bg-gradient-to-t from-primary/5 to-transparent -z-10"></div>
    
    <div class="container mx-auto px-4">
        <div class="text-center mb-12">
            <h2 class="text-3xl md:text-4xl font-bold mb-4">You Could Save Thousands</h2>
            <p class="text-xl text-text-muted max-w-3xl mx-auto">See if you qualify for our debt relief program in just 30 seconds.</p>
        </div>
        
        <!-- Enhanced Form Container -->
        <div class="form-container max-w-2xl mx-auto relative">
            <!-- Glowing effect for emphasis -->
            <div class="absolute -inset-1 bg-gradient-to-r from-primary/20 via-accent/30 to-primary/20 rounded-xl blur-md"></div>
            
            <div class="relative bg-background-form dark:bg-slate-800 p-8 md:p-10 rounded-xl shadow-xl border border-border">
                <div class="mb-8 flex items-center justify-between">
                    <h3 class="font-bold text-2xl">Quick Debt Relief Check</h3>
                    <div class="secure-badge flex items-center gap-2 bg-primary/10 text-primary px-3 py-1 rounded-full text-sm font-medium">
                        <LockIcon />
                        <span>Secure & Confidential</span>
                    </div>
                </div>
                
                <form id="debt-relief-form" class="space-y-6">
                    <div class="form-group">
                        <label for="debt-amount" class="form-label block mb-2 text-lg">How much debt do you have?*</label>
                        <select 
                            id="debt-amount" 
                            name="debtAmount" 
                            class="w-full p-4 rounded-lg text-lg transition-shadow duration-200 focus:ring-2 focus:ring-primary/50" 
                            required
                        >
                            <option value="">Select Amount</option>
                            <option value="5000-10000">$5,000 - $10,000</option>
                            <option value="10000-25000">$10,000 - $25,000</option>
                            <option value="25000-50000">$25,000 - $50,000</option>
                            <option value="50000+">$50,000+</option>
                        </select>
                        <div id="debt-amount-error" class="error-message hidden mt-2 pl-1"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="debt-type" class="form-label block mb-2 text-lg">What type of debt do you have?*</label>
                        <select 
                            id="debt-type" 
                            name="debtType" 
                            class="w-full p-4 rounded-lg text-lg transition-shadow duration-200 focus:ring-2 focus:ring-primary/50" 
                            required
                        >
                            <option value="">Select Type</option>
                            <option value="credit-card">Credit Card</option>
                            <option value="medical">Medical</option>
                            <option value="personal-loans">Personal Loans</option>
                            <option value="mixed">Mixed Debt</option>
                        </select>
                        <div id="debt-type-error" class="error-message hidden mt-2 pl-1"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="phone" class="form-label block mb-2 text-lg">Phone Number*</label>
                        <div class="relative">
                            <input 
                                type="tel" 
                                id="phone" 
                                name="phone"
                                class="w-full p-4 pl-10 rounded-lg text-lg transition-shadow duration-200 focus:ring-2 focus:ring-primary/50" 
                                placeholder="(000) 000-0000"
                                pattern="^\(\d{3}\) \d{3}-\d{4}$"
                                required
                                aria-describedby="phone-format"
                            />
                            <div class="absolute left-3 top-1/2 transform -translate-y-1/2 text-text-muted">
                                <PhoneIcon width="20" height="20" />
                            </div>
                        </div>
                        <small id="phone-format" class="text-text-muted text-sm block mt-1 pl-1">Format: (XXX) XXX-XXXX</small>
                        <div id="phone-error" class="error-message hidden mt-2 pl-1"></div>
                    </div>
                    
                    <button 
                        type="submit" 
                        class="btn w-full py-4 text-lg font-bold mt-6 relative overflow-hidden group"
                        aria-label="Submit form to check eligibility"
                    >
                        <span class="relative z-10">Check My Eligibility Now</span>
                        <div class="absolute inset-0 bg-gradient-to-r from-primary via-secondary to-primary bg-[length:200%_100%] animate-gradient"></div>
                    </button>
                    
                    <div class="text-center mt-4 text-sm text-text-muted">
                        <p class="flex items-center justify-center gap-1">
                            <ShieldIcon width="16" height="16" />
                            Your information is protected with 256-bit encryption
                        </p>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Form Benefits -->
        <div class="form-benefits mt-12 grid grid-cols-1 md:grid-cols-3 gap-8 max-w-4xl mx-auto">
            <div class="benefit-item text-center">
                <div class="icon-wrapper bg-primary/10 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                    <ShieldIcon width="32" height="32" class="text-primary" />
                </div>
                <h4 class="font-bold mb-2">100% Free Consultation</h4>
                <p class="text-text-muted">No obligation or upfront fees to get started.</p>
            </div>
            
            <div class="benefit-item text-center">
                <div class="icon-wrapper bg-primary/10 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                    <CheckIcon width="32" height="32" class="text-primary" />
                </div>
                <h4 class="font-bold mb-2">Instant Qualification Check</h4>
                <p class="text-text-muted">Find out if you qualify in as little as 30 seconds.</p>
            </div>
            
            <div class="benefit-item text-center">
                <div class="icon-wrapper bg-primary/10 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                    <CreditCardAltIcon class="text-primary" />
                </div>
                <h4 class="font-bold mb-2">No Impact On Credit Score</h4>
                <p class="text-text-muted">Our qualification process won't hurt your credit.</p>
            </div>
        </div>
    </div>
</div>

<style>
    /* Enhanced focus states for better accessibility */
    select:focus, input:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(45, 121, 132, 0.3); /* Updated to match new primary color */
        border-color: var(--color-primary);
    }
    
    /* Dark mode focus states */
    .dark select:focus, .dark input:focus {
        box-shadow: 0 0 0 3px rgba(88, 203, 224, 0.4); /* Brighter in dark mode */
    }
    
    /* Error states with high contrast */
    .error-message {
        color: var(--color-error);
        font-size: 0.875rem;
        font-weight: 500;
    }
    
    .input-error {
        border-color: var(--color-error) !important;
    }
    
    /* Make sure placeholders have enough contrast */
    input::placeholder {
        color: var(--color-placeholder);
        opacity: 1;
    }
    
    /* Form animations */
    .form-container {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .form-container:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
    }
    
    @media (prefers-reduced-motion: reduce) {
        .form-container:hover {
            transform: none;
            box-shadow: none;
        }
    }
    
    /* Submit button animation */
    @keyframes gradient {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }
    
    .animate-gradient {
        animation: gradient 3s ease infinite;
    }
    
    /* Benefit items animation */
    .benefit-item {
        transition: transform 0.3s ease;
    }
    
    .benefit-item:hover {
        transform: translateY(-5px);
    }
    
    .icon-wrapper {
        transition: all 0.3s ease;
    }
    
    .benefit-item:hover .icon-wrapper {
        transform: scale(1.1);
        box-shadow: 0 0 15px rgba(var(--color-primary-rgb), 0.3);
    }
    
    @media (prefers-reduced-motion: reduce) {
        .animate-gradient {
            animation: none;
        }
        
        .benefit-item:hover {
            transform: none;
        }
        
        .benefit-item:hover .icon-wrapper {
            transform: none;
            box-shadow: none;
        }
    }
</style>

<script>
// Client-side validation and form handling
document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('debt-relief-form');
    const phoneInput = document.getElementById('phone');
    const debtAmountSelect = document.getElementById('debt-amount');
    const debtTypeSelect = document.getElementById('debt-type');
    
    const debtAmountError = document.getElementById('debt-amount-error');
    const debtTypeError = document.getElementById('debt-type-error');
    const phoneError = document.getElementById('phone-error');
    
    // Function to show error
    const showError = (element, errorElement, message) => {
        element.classList.add('input-error');
        errorElement.textContent = message;
        errorElement.classList.remove('hidden');
    };
    
    // Function to clear error
    const clearError = (element, errorElement) => {
        element.classList.remove('input-error');
        errorElement.textContent = '';
        errorElement.classList.add('hidden');
    };
    
    // Basic phone formatting
    phoneInput && phoneInput.addEventListener('input', (e) => {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length > 0) {
            if (value.length <= 3) {
                value = `(${value}`;
            } else if (value.length <= 6) {
                value = `(${value.slice(0, 3)}) ${value.slice(3)}`;
            } else {
                value = `(${value.slice(0, 3)}) ${value.slice(3, 6)}-${value.slice(6, 10)}`;
            }
        }
        e.target.value = value;
        
        // Clear error when user types
        clearError(phoneInput, phoneError);
    });
    
    // Clear errors when user selects an option
    debtAmountSelect && debtAmountSelect.addEventListener('change', () => clearError(debtAmountSelect, debtAmountError));
    debtTypeSelect && debtTypeSelect.addEventListener('change', () => clearError(debtTypeSelect, debtTypeError));
    
    // Form submission
    if (form) {
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            let isValid = true;
            
            // Validate debt amount
            if (!debtAmountSelect.value) {
                showError(debtAmountSelect, debtAmountError, 'Please select your debt amount');
                isValid = false;
            }
            
            // Validate debt type
            if (!debtTypeSelect.value) {
                showError(debtTypeSelect, debtTypeError, 'Please select your debt type');
                isValid = false;
            }
            
            // Validate phone
            if (!phoneInput.value.match(/^\(\d{3}\) \d{3}-\d{4}$/)) {
                showError(phoneInput, phoneError, 'Please enter a valid phone number');
                isValid = false;
            }
            
            if (!isValid) {
                return;
            }
            
            // Create success message
            const formContainer = form.closest('.relative');
            const successMessage = document.createElement('div');
            successMessage.className = 'text-center py-8';
            // Note: We can't use the Astro component directly in JS, so we use the SVG inline
            successMessage.innerHTML = `
                <div class="success-icon mx-auto mb-6 bg-primary/20 w-20 h-20 rounded-full flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" class="text-primary" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                    </svg>
                </div>
                <h3 class="text-2xl font-bold mb-4">Thank You!</h3>
                <p class="text-lg text-text-muted mb-6">A debt relief specialist will contact you shortly to discuss your options.</p>
                <p class="text-text-muted">Need immediate assistance? Call us at <span class="text-primary font-semibold">(800) 555-1234</span></p>
            `;
            
            // Hide form and show success message with animation
            form.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
            form.style.opacity = '0';
            form.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                form.style.display = 'none';
                formContainer.appendChild(successMessage);
                
                // Reset form
                form.reset();
                
                // Clear all errors
                clearError(debtAmountSelect, debtAmountError);
                clearError(debtTypeSelect, debtTypeError);
                clearError(phoneInput, phoneError);
            }, 500);
        });
    }
});
</script>